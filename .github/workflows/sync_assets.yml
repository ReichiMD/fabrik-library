name: ðŸ”„ Library Sync & Index

on:
  schedule:
    - cron: '0 4 * * 1'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-library:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Library auschecken
        uses: actions/checkout@v4

      - name: 2. Mojang Assets holen (Sparse Checkout inkl. Animationen)
        uses: actions/checkout@v4
        with:
          repository: Mojang/bedrock-samples
          path: temp_mojang
          sparse-checkout: |
            resource_pack/textures/items
            resource_pack/textures/blocks
            resource_pack/textures/entity
            resource_pack/textures/ui
            resource_pack/models
            resource_pack/animations
            resource_pack/animation_controllers
          sparse-checkout-cone-mode: false

      - name: 3. Dateien einsortieren
        run: |
          echo "ðŸ§¹ Bereinige alte Vanilla-Assets..."
          rm -rf assets/vanilla/*
          mkdir -p assets/vanilla/textures
          mkdir -p assets/vanilla/models
          mkdir -p assets/vanilla/animations
          
          echo "ðŸ“¦ Kopiere neue Assets..."
          cp -r temp_mojang/resource_pack/textures/items assets/vanilla/textures/ 2>/dev/null || :
          cp -r temp_mojang/resource_pack/textures/blocks assets/vanilla/textures/ 2>/dev/null || :
          cp -r temp_mojang/resource_pack/textures/entity assets/vanilla/textures/ 2>/dev/null || :
          cp -r temp_mojang/resource_pack/textures/ui assets/vanilla/textures/ 2>/dev/null || :
          cp -r temp_mojang/resource_pack/models assets/vanilla/models/ 2>/dev/null || :
          # NEU: Animationen kopieren
          cp -r temp_mojang/resource_pack/animations assets/vanilla/animations/ 2>/dev/null || :
          cp -r temp_mojang/resource_pack/animation_controllers assets/vanilla/animations/ 2>/dev/null || :
          
          rm -rf temp_mojang
          echo "âœ… Kopiervorgang abgeschlossen."

      - name: 4. Python Setup
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 5. Index neu generieren
        run: python tools/indexer.py

      - name: 6. Ã„nderungen speichern
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ðŸ“š Auto-Update: Vanilla Assets & Animations"
          file_pattern: "assets/vanilla/* library_index.json"
          
